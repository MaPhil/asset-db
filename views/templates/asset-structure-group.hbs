<div
  class="asset-structure-app"
  data-app="asset-structure"
  data-group-slug="{{group.slug}}"
  data-group-name="{{group.displayTitle}}"
  data-topic-id="{{topic.id}}"
  data-sub-topic-id="{{subTopic.id}}"
  data-asset-sub-category-slug="{{assetSubCategory.slug}}"
  data-group-selector-count="{{groupSelectorCount}}"
>
  <section class="asset-structure-content">
    <div class="toast-container" role="status" aria-live="polite"></div>
    <header class="page-header">
      <div>
        <h1 class="page-title">{{#if group.displayTitle}}{{group.displayTitle}}{{else}}Unbenannte Gruppe{{/if}}</h1>
        <p class="page-subtitle">Überprüfen und bearbeiten Sie die Gruppendetails, ohne Ihren Arbeitsablauf zu verlassen.</p>
      </div>
      <div class="page-actions">
        {{#if assetSubCategory.measuresUrl}}
          <a class="button button--ghost" href="{{assetSubCategory.measuresUrl}}">Maßnahmen anzeigen</a>
        {{/if}}
        <a class="button button--ghost" href="/asset-structure/{{topic.id}}/{{subTopic.id}}/{{assetSubCategory.slug}}">Zur AssetUnterKategorie zurück</a>
        <button
          class="button button--danger"
          type="button"
          data-delete-group
          data-confirm="Diese Gruppe löschen? Dieser Vorgang kann nicht rückgängig gemacht werden."
          data-disabled-title="Gruppe kann nicht gelöscht werden, solange Asset-Selectoren vorhanden sind."
          {{#if groupSelectorCount}}
            disabled
            aria-disabled="true"
            title="Gruppe kann nicht gelöscht werden, solange Asset-Selectoren vorhanden sind."
          {{/if}}
        >
          Gruppe löschen
        </button>
      </div>
    </header>

    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="/asset-structure">Asset-Struktur</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}">{{topic.displayTitle}}</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}/{{subTopic.id}}">{{subTopic.displayTitle}}</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}/{{subTopic.id}}/{{assetSubCategory.slug}}">{{assetSubCategory.title}}</a>
      <span aria-hidden="true">›</span>
      <span aria-current="page">{{group.displayTitle}}</span>
    </nav>

    <div class="structure-body">
      <section class="card structure-card" aria-labelledby="group-details-title">
        <div class="section-header">
          <h2 class="section-title" id="group-details-title">Gruppeninformationen</h2>
          <button class="button" type="button" data-save-group-details>Änderungen speichern</button>
        </div>
        <form class="form-grid form-grid--two" data-group-details-form>
          <div class="form-field form-field--full">
            <label for="group-name">Titel</label>
            <input
              id="group-name"
              name="title"
              type="text"
              value="{{group.title}}"
              placeholder="Gruppentitel eingeben"
            />
          </div>
          <div class="form-row form-row--triple">
            <div class="form-field">
              <label for="group-integrity">Integrität</label>
              <select id="group-integrity" name="integrity">
                <option value="" {{#unless group.integrity}}selected{{/unless}}>Integrität auswählen</option>
                <option value="low" {{#if (eq group.integrity 'low')}}selected{{/if}}>Niedrig</option>
                <option value="medium" {{#if (eq group.integrity 'medium')}}selected{{/if}}>Mittel</option>
                <option value="high" {{#if (eq group.integrity 'high')}}selected{{/if}}>Hoch</option>
                <option value="very_high" {{#if (eq group.integrity 'very_high')}}selected{{/if}}>Sehr hoch</option>
              </select>
            </div>
            <div class="form-field">
              <label for="group-confidentiality">Vertraulichkeit</label>
              <select id="group-confidentiality" name="confidentiality">
                <option value="" {{#unless group.confidentiality}}selected{{/unless}}>Vertraulichkeit auswählen</option>
                <option value="low" {{#if (eq group.confidentiality 'low')}}selected{{/if}}>Niedrig</option>
                <option value="medium" {{#if (eq group.confidentiality 'medium')}}selected{{/if}}>Mittel</option>
                <option value="high" {{#if (eq group.confidentiality 'high')}}selected{{/if}}>Hoch</option>
                <option value="very_high" {{#if (eq group.confidentiality 'very_high')}}selected{{/if}}>Sehr hoch</option>
              </select>
            </div>
            <div class="form-field">
              <label for="group-availability">Verfügbarkeit</label>
              <select id="group-availability" name="availability">
                <option value="" {{#unless group.availability}}selected{{/unless}}>Verfügbarkeit auswählen</option>
                <option value="low" {{#if (eq group.availability 'low')}}selected{{/if}}>Niedrig</option>
                <option value="medium" {{#if (eq group.availability 'medium')}}selected{{/if}}>Mittel</option>
                <option value="high" {{#if (eq group.availability 'high')}}selected{{/if}}>Hoch</option>
                <option value="very_high" {{#if (eq group.availability 'very_high')}}selected{{/if}}>Sehr hoch</option>
              </select>
            </div>
          </div>
          <div class="form-field form-field--full">
            <label for="group-parent-category-input">Übergeordnete AssetUnterKategorie</label>
            <input
              id="group-parent-category-input"
              type="text"
              value="{{assetSubCategory.title}}"
              disabled
              aria-describedby="group-category-helper"
            />
            <p class="helper-text" id="group-category-helper">
              Die übergeordnete AssetUnterKategorie ist festgelegt und kann nicht geändert werden.
            </p>
          </div>
          <div class="form-field form-field--full">
            <label for="group-description">Beschreibung</label>
            <textarea
              id="group-description"
              name="description"
              rows="4"
              placeholder="Kurze Beschreibung hinzufügen"
            >{{group.description}}</textarea>
          </div>
        </form>
        <p class="form-error" data-group-details-feedback hidden></p>
        <dl class="meta-grid">
          <div class="meta-item">
            <dt>Erstellt</dt>
            <dd>{{group.createdAt}}</dd>
          </div>
          <div class="meta-item">
            <dt>Zuletzt aktualisiert</dt>
            <dd>{{group.updatedAt}}</dd>
          </div>
        </dl>
      </section>

      <section class="card structure-card" aria-labelledby="group-asset-selectors-title">
        <div class="section-header">
          <div>
            <h2 class="section-title" id="group-asset-selectors-title">Assets</h2>
            <p class="helper-text">
              Erstellen Sie Asset-Selektoren, um passende Assets aus dem Pool zu sammeln.
            </p>
          </div>
          <button class="button" type="button" data-open-group-selector-modal>Asset-Selektor erstellen</button>
        </div>
        <p class="helper-text" data-group-selector-loading hidden>Asset-Selektoren werden geladen …</p>
        <p class="form-error" data-group-selector-error hidden></p>
        <p class="empty-state" data-group-selector-empty hidden>
          Für diese Gruppe wurden noch keine Asset-Selektoren erstellt.
        </p>
        <ul class="asset-selector-list" data-group-selector-list hidden></ul>
      </section>
    </div>
  </section>
</div>

<script type="application/json" data-group-selector-state>{{{json groupSelectorState}}}</script>

<div class="modal" data-group-selector-modal hidden aria-hidden="true">
  <div
    class="modal-dialog modal-dialog--large"
    role="dialog"
    aria-modal="true"
    aria-labelledby="group-selector-modal-title"
  >
    <header class="modal-header">
      <h2 id="group-selector-modal-title">Asset-Selektor erstellen</h2>
      <button
        class="icon-button"
        type="button"
        aria-label="Konfiguration des Asset-Selektors schließen"
        data-close-group-selector-modal
      >
        &times;
      </button>
    </header>
    <div class="modal-body">
      <form class="selector-form" id="group-selector-form" data-group-selector-form>
        <div class="form-field form-field--full">
          <label for="group-selector-name">Titel</label>
          <input
            id="group-selector-name"
            type="text"
            name="name"
            placeholder="Asset-Selektor benennen"
            data-group-selector-name
            autocomplete="off"
          />
        </div>
        <div class="form-field form-field--full">
          <label for="group-selector-description">Beschreibung</label>
          <textarea
            id="group-selector-description"
            name="description"
            rows="3"
            placeholder="Kurze Beschreibung hinzufügen"
            data-group-selector-description
          ></textarea>
        </div>
        <div class="selector-builder" data-selector-builder>
          <p class="helper-text selector-builder__hint">
            Definieren Sie Regeln und Gruppen, um festzulegen, welche Assets zu diesem Selektor gehören.
          </p>
          <div class="selector-group" data-selector-root></div>
        </div>
        <p class="form-error" data-group-selector-form-error hidden></p>
      </form>
    </div>
    <div class="modal-footer">
      <button class="button button--ghost" type="button" data-close-group-selector-modal>Abbrechen</button>
      <button class="button" type="submit" form="group-selector-form" data-save-group-selector>Speichern</button>
    </div>
  </div>
</div>

<div class="modal" data-group-selector-assets-modal hidden aria-hidden="true">
  <div
    class="modal-dialog modal-dialog--large"
    role="dialog"
    aria-modal="true"
    aria-labelledby="group-selector-assets-title"
  >
    <header class="modal-header">
      <h2 id="group-selector-assets-title">Assets anzeigen</h2>
      <button
        class="icon-button"
        type="button"
        aria-label="Asset-Liste schließen"
        data-close-group-selector-assets-modal
      >
        &times;
      </button>
    </header>
    <div class="modal-body">
      <p class="helper-text" data-group-selector-assets-loading>Assets werden geladen …</p>
      <p class="form-error" data-group-selector-assets-error hidden></p>
      <div class="table-container" data-group-selector-assets-table hidden></div>
    </div>
    <div class="modal-footer">
      <button class="button" type="button" data-close-group-selector-assets-modal>Schließen</button>
    </div>
  </div>
</div>
