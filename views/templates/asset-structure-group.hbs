<div
  class="asset-structure-app"
  data-app="asset-structure"
  data-group-id="{{group.id}}"
  data-group-name="{{group.displayTitle}}"
  data-topic-id="{{topic.id}}"
  data-sub-topic-id="{{subTopic.id}}"
  data-asset-sub-category-id="{{assetSubCategory.id}}"
  data-group-selector-count="{{groupSelectorCount}}"
>
  <aside class="asset-structure-sidebar" aria-label="Asset-Struktur-Navigation">
    <div class="sidebar-section">
      <a href="/asset-structure" class="sidebar-link sidebar-link--active">Themengebiete</a>
      <a href="/asset-categories" class="sidebar-link">Asset-Kategorien</a>
    </div>
  </aside>
  <section class="asset-structure-content">
    <header class="page-header">
      <div>
        <h1 class="page-title">{{#if group.displayTitle}}{{group.displayTitle}}{{else}}Unbenannte Gruppe{{/if}}</h1>
        <p class="page-subtitle">Überprüfen und bearbeiten Sie die Gruppendetails, ohne Ihren Arbeitsablauf zu verlassen.</p>
      </div>
      <div class="page-actions">
        {{#if assetSubCategory.measuresUrl}}
          <a class="button button--ghost" href="{{assetSubCategory.measuresUrl}}">Maßnahmen anzeigen</a>
        {{/if}}
        <a class="button button--ghost" href="/asset-structure/{{topic.id}}/{{subTopic.id}}/{{assetSubCategory.id}}">Zur AssetUnterKategorie zurück</a>
        <button
          class="button button--danger"
          type="button"
          data-delete-group
          data-confirm="Diese Gruppe löschen? Dieser Vorgang kann nicht rückgängig gemacht werden."
          data-disabled-title="Gruppe kann nicht gelöscht werden, solange Asset-Selectoren vorhanden sind."
          {{#if groupSelectorCount}}
            disabled
            aria-disabled="true"
            title="Gruppe kann nicht gelöscht werden, solange Asset-Selectoren vorhanden sind."
          {{/if}}
        >
          Gruppe löschen
        </button>
      </div>
    </header>

    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="/asset-structure">Asset-Struktur</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}">{{topic.displayTitle}}</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}/{{subTopic.id}}">{{subTopic.displayTitle}}</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}/{{subTopic.id}}/{{assetSubCategory.id}}">{{assetSubCategory.title}}</a>
      <span aria-hidden="true">›</span>
      <span aria-current="page">{{group.displayTitle}}</span>
    </nav>

    <div class="structure-body">
      <section class="card structure-card" aria-labelledby="group-details-title">
        <div class="section-header">
          <h2 class="section-title" id="group-details-title">Gruppeninformationen</h2>
          <button class="button" type="button">Änderungen speichern</button>
        </div>
        <form class="form-grid form-grid--two">
          <div class="form-field">
            <label for="group-name">Titel</label>
            <input
              id="group-name"
              name="title"
              type="text"
              value="{{group.title}}"
              placeholder="Gruppentitel eingeben"
            />
          </div>
          <div class="form-field">
            <label for="group-parent-category">Übergeordnete AssetUnterKategorie</label>
            <select id="group-parent-category" name="category_id">
              {{#if assetSubCategoryOptions.length}}
                {{#each assetSubCategoryOptions}}
                  <option value="{{id}}" {{#if (eq ../assetSubCategory.id id)}}selected{{/if}}>{{title}}</option>
                {{/each}}
              {{else}}
                <option value="" disabled>Keine AssetUnterKategorien verfügbar</option>
              {{/if}}
            </select>
          </div>
          <div class="form-field">
            <label for="group-status">Status</label>
            <select id="group-status" name="status">
              <option value="" {{#unless group.status}}selected{{/unless}}>Status auswählen</option>
              <option {{#if (eq group.status 'Active')}}selected{{/if}}>Aktiv</option>
              <option {{#if (eq group.status 'Planned')}}selected{{/if}}>Geplant</option>
              <option {{#if (eq group.status 'Retired')}}selected{{/if}}>Außer Betrieb</option>
            </select>
          </div>
          <div class="form-field form-field--full">
            <label for="group-description">Beschreibung</label>
            <textarea
              id="group-description"
              name="description"
              rows="4"
              placeholder="Kurze Beschreibung hinzufügen"
            >{{group.description}}</textarea>
          </div>
          <div class="form-field">
            <label for="group-asset-type">Asset-Typ</label>
            <input
              id="group-asset-type"
              type="text"
              name="asset_type"
              value="{{group.assetType}}"
              placeholder="z. B. Anwendung"
            />
          </div>
        </form>
        <dl class="meta-grid">
          <div class="meta-item">
            <dt>Erstellt</dt>
            <dd>{{group.createdAt}}</dd>
          </div>
          <div class="meta-item">
            <dt>Zuletzt aktualisiert</dt>
            <dd>{{group.updatedAt}}</dd>
          </div>
        </dl>
      </section>

      <section class="card structure-card" aria-labelledby="group-asset-selectors-title">
        <div class="section-header">
          <div>
            <h2 class="section-title" id="group-asset-selectors-title">Assets</h2>
            <p class="helper-text">
              Create Asset Selectors to gather matching assets from the pool.
            </p>
          </div>
          <button class="button" type="button" data-open-group-selector-modal>Create Asset Selector</button>
        </div>
        <p class="helper-text" data-group-selector-loading hidden>Loading asset selectors…</p>
        <p class="form-error" data-group-selector-error hidden></p>
        <p class="empty-state" data-group-selector-empty hidden>
          No asset selectors have been created for this group yet.
        </p>
        <ul class="asset-selector-list" data-group-selector-list hidden></ul>
      </section>
    </div>
  </section>
</div>

<script type="application/json" data-group-selector-state>{{{json groupSelectorState}}}</script>

<div class="modal" data-group-selector-modal hidden aria-hidden="true">
  <div
    class="modal-dialog modal-dialog--large"
    role="dialog"
    aria-modal="true"
    aria-labelledby="group-selector-modal-title"
  >
    <header class="modal-header">
      <h2 id="group-selector-modal-title">Create Asset Selector</h2>
      <button
        class="icon-button"
        type="button"
        aria-label="Close asset selector configuration"
        data-close-group-selector-modal
      >
        &times;
      </button>
    </header>
    <div class="modal-body">
      <form class="selector-form" id="group-selector-form" data-group-selector-form>
        <div class="form-field form-field--full">
          <label for="group-selector-name">Title</label>
          <input
            id="group-selector-name"
            type="text"
            name="name"
            placeholder="Name the asset selector"
            data-group-selector-name
            autocomplete="off"
          />
        </div>
        <div class="form-field form-field--full">
          <label for="group-selector-description">Description</label>
          <textarea
            id="group-selector-description"
            name="description"
            rows="3"
            placeholder="Add a brief description"
            data-group-selector-description
          ></textarea>
        </div>
        <div class="selector-builder" data-selector-builder>
          <p class="helper-text selector-builder__hint">
            Define rules and groups to decide which assets belong to this selector.
          </p>
          <div class="selector-group" data-selector-root></div>
        </div>
        <p class="form-error" data-group-selector-form-error hidden></p>
      </form>
    </div>
    <div class="modal-footer">
      <button class="button button--ghost" type="button" data-close-group-selector-modal>Cancel</button>
      <button class="button" type="submit" form="group-selector-form" data-save-group-selector>Save</button>
    </div>
  </div>
</div>

<div class="modal" data-group-selector-assets-modal hidden aria-hidden="true">
  <div
    class="modal-dialog modal-dialog--large"
    role="dialog"
    aria-modal="true"
    aria-labelledby="group-selector-assets-title"
  >
    <header class="modal-header">
      <h2 id="group-selector-assets-title">Show Assets</h2>
      <button
        class="icon-button"
        type="button"
        aria-label="Close asset list"
        data-close-group-selector-assets-modal
      >
        &times;
      </button>
    </header>
    <div class="modal-body">
      <p class="helper-text" data-group-selector-assets-loading>Loading assets…</p>
      <p class="form-error" data-group-selector-assets-error hidden></p>
      <div class="table-container" data-group-selector-assets-table hidden></div>
    </div>
    <div class="modal-footer">
      <button class="button" type="button" data-close-group-selector-assets-modal>Close</button>
    </div>
  </div>
</div>
