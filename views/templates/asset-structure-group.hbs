<div
  class="asset-structure-app"
  data-app="asset-structure"
  data-group-id="{{group.id}}"
  data-group-name="{{group.displayTitle}}"
  data-available-group-asset-types="{{availableGroupAssetTypesCount}}"
  data-topic-id="{{topic.id}}"
  data-sub-topic-id="{{subTopic.id}}"
  data-asset-sub-category-id="{{assetSubCategory.id}}"
  data-group-asset-type-count="{{groupAssetTypeCount}}"
>
  <aside class="asset-structure-sidebar" aria-label="Asset-Struktur-Navigation">
    <div class="sidebar-section">
      <a href="/asset-structure" class="sidebar-link sidebar-link--active">Themengebiete</a>
      <a href="/asset-types" class="sidebar-link">Asset-Typen</a>
      <a href="/asset-categories" class="sidebar-link">Asset-Kategorien</a>
    </div>
  </aside>
  <section class="asset-structure-content">
    <header class="page-header">
      <div>
        <h1 class="page-title">{{#if group.displayTitle}}{{group.displayTitle}}{{else}}Unbenannte Gruppe{{/if}}</h1>
        <p class="page-subtitle">Überprüfen und bearbeiten Sie die Gruppendetails, ohne Ihren Arbeitsablauf zu verlassen.</p>
      </div>
      <div class="page-actions">
        {{#if assetSubCategory.measuresUrl}}
          <a class="button button--ghost" href="{{assetSubCategory.measuresUrl}}">Maßnahmen anzeigen</a>
        {{/if}}
        <a class="button button--ghost" href="/asset-structure/{{topic.id}}/{{subTopic.id}}/{{assetSubCategory.id}}">Zur AssetUnterKategorie zurück</a>
        <button
          class="button button--danger"
          type="button"
          data-delete-group
          data-confirm="Diese Gruppe löschen? Dieser Vorgang kann nicht rückgängig gemacht werden."
          data-disabled-title="Gruppe kann nicht gelöscht werden, solange Asset-Typen zugeordnet sind."
          {{#if groupAssetTypeCount}}
            disabled
            aria-disabled="true"
            title="Gruppe kann nicht gelöscht werden, solange Asset-Typen zugeordnet sind."
          {{/if}}
        >
          Gruppe löschen
        </button>
      </div>
    </header>

    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="/asset-structure">Asset-Struktur</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}">{{topic.displayTitle}}</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}/{{subTopic.id}}">{{subTopic.displayTitle}}</a>
      <span aria-hidden="true">›</span>
      <a href="/asset-structure/{{topic.id}}/{{subTopic.id}}/{{assetSubCategory.id}}">{{assetSubCategory.title}}</a>
      <span aria-hidden="true">›</span>
      <span aria-current="page">{{group.displayTitle}}</span>
    </nav>

    <div class="structure-body">
      <section class="card structure-card" aria-labelledby="group-details-title">
        <div class="section-header">
          <h2 class="section-title" id="group-details-title">Gruppeninformationen</h2>
          <button class="button" type="button">Änderungen speichern</button>
        </div>
        <form class="form-grid form-grid--two">
          <div class="form-field">
            <label for="group-name">Titel</label>
            <input
              id="group-name"
              name="title"
              type="text"
              value="{{group.title}}"
              placeholder="Gruppentitel eingeben"
            />
          </div>
          <div class="form-field">
            <label for="group-parent-category">Übergeordnete AssetUnterKategorie</label>
            <select id="group-parent-category" name="category_id">
              {{#if assetSubCategoryOptions.length}}
                {{#each assetSubCategoryOptions}}
                  <option value="{{id}}" {{#if (eq ../assetSubCategory.id id)}}selected{{/if}}>{{title}}</option>
                {{/each}}
              {{else}}
                <option value="" disabled>Keine AssetUnterKategorien verfügbar</option>
              {{/if}}
            </select>
          </div>
          <div class="form-field">
            <label for="group-status">Status</label>
            <select id="group-status" name="status">
              <option value="" {{#unless group.status}}selected{{/unless}}>Status auswählen</option>
              <option {{#if (eq group.status 'Active')}}selected{{/if}}>Aktiv</option>
              <option {{#if (eq group.status 'Planned')}}selected{{/if}}>Geplant</option>
              <option {{#if (eq group.status 'Retired')}}selected{{/if}}>Außer Betrieb</option>
            </select>
          </div>
          <div class="form-field form-field--full">
            <label for="group-description">Beschreibung</label>
            <textarea
              id="group-description"
              name="description"
              rows="4"
              placeholder="Kurze Beschreibung hinzufügen"
            >{{group.description}}</textarea>
          </div>
          <div class="form-field">
            <label for="group-asset-type">Asset-Typ</label>
            <input
              id="group-asset-type"
              type="text"
              name="asset_type"
              value="{{group.assetType}}"
              placeholder="z. B. Anwendung"
            />
          </div>
        </form>
        <dl class="meta-grid">
          <div class="meta-item">
            <dt>Erstellt</dt>
            <dd>{{group.createdAt}}</dd>
          </div>
          <div class="meta-item">
            <dt>Zuletzt aktualisiert</dt>
            <dd>{{group.updatedAt}}</dd>
          </div>
        </dl>
      </section>

      <section class="card structure-card" aria-labelledby="group-asset-types-title">
        <div class="section-header">
          <h2 class="section-title" id="group-asset-types-title">Asset-Typen</h2>
          <button class="button" type="button" data-open-group-asset-type-modal>Asset-Typ hinzufügen</button>
        </div>
        <p class="helper-text">
          Wählen Sie aus den verfügbaren Asset-Typen aus Ihrem Asset-Pool. Jeder Asset-Typ kann nur einer
          Gruppe zugeordnet sein, sofern er nicht ignoriert wird.
        </p>
        <p
          class="empty-state"
          data-group-asset-type-empty
          {{#if groupAssetTypes.length}}hidden{{/if}}
        >
          Dieser Gruppe wurden noch keine Asset-Typen zugewiesen.
        </p>
        <ul
          class="group-asset-type-list"
          data-group-asset-type-list
          {{#unless groupAssetTypes.length}}hidden{{/unless}}
        >
          {{#each groupAssetTypes}}
            <li
              class="group-asset-type-list__item"
              data-group-asset-type-item
              data-group-asset-type-name="{{name}}"
              {{#if id}}data-group-asset-type-id="{{id}}"{{/if}}
              {{#if isLegacy}}data-group-asset-type-legacy="true"{{/if}}
            >
              <div class="group-asset-type-pill{{#if isLegacy}} group-asset-type-pill--legacy{{/if}}">
                <div class="group-asset-type-pill__header">
                  <span class="group-asset-type-pill__name">{{name}}</span>
                  <div class="group-asset-type-pill__actions">
                    <button
                      type="button"
                      class="icon-button group-asset-type-pill__remove"
                      aria-label="Asset-Typ {{name}} aus dieser Gruppe entfernen"
                      data-group-asset-type-name="{{name}}"
                      {{#if id}}
                        data-remove-group-asset-type="{{id}}"
                      {{else}}
                        disabled
                        aria-disabled="true"
                        title="Aktualisieren Sie die Gruppeninformationen, um diesen Asset-Typ zu entfernen."
                      {{/if}}
                    >
                      &times;
                    </button>
                  </div>
                </div>
                <span class="group-asset-type-pill__meta">
                  {{#if count}}
                    {{count}} {{#if (eq count 1)}}Asset{{else}}Assets{{/if}}
                  {{else}}
                    Noch keine Einträge im Asset-Pool
                  {{/if}}
                </span>
                {{#if isLegacy}}
                  <span class="group-asset-type-pill__tag">Aus Gruppendetails</span>
                {{/if}}
              </div>
            </li>
          {{/each}}
        </ul>
      </section>
    </div>
  </section>
</div>

<div class="modal" data-group-asset-type-modal hidden aria-hidden="true">
  <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="group-asset-type-modal-title">
    <header class="modal-header">
      <h2 id="group-asset-type-modal-title">Asset-Typ hinzufügen</h2>
      <button
        class="icon-button"
        type="button"
        aria-label="Auswahl des Asset-Typs schließen"
        data-close-group-asset-type-modal
      >
        &times;
      </button>
    </header>
    <div class="modal-body">
      <p class="modal-description">
        Wählen Sie einen der verfügbaren Asset-Typen, um ihn mit {{group.displayTitle}} zu verknüpfen.
      </p>
      <p class="helper-text" data-group-asset-type-loading>Verfügbare Asset-Typen werden geladen…</p>
      <p class="empty-state" data-group-asset-type-modal-empty hidden>
        Alle Asset-Typen sind derzeit anderen Gruppen zugeordnet oder zum Ignorieren markiert.
      </p>
      <p class="form-error" data-group-asset-type-error hidden></p>
      <ul class="group-asset-type-modal__list" data-group-asset-type-options></ul>
    </div>
    <div class="modal-footer">
      <button class="button button--ghost" type="button" data-close-group-asset-type-modal>Schließen</button>
    </div>
  </div>
</div>
